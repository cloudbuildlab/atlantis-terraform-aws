name: Create Pull Request as Bot

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Source branch name"
        required: true
        type: string
      title:
        description: "PR title"
        required: true
        type: string
      body:
        description: "PR body/description"
        required: false
        type: string
        default: ""

permissions:
  contents: read
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Generate GitHub App token
        id: app-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ secrets.GH_PR_BOT_APP_ID }}
          private-key: ${{ secrets.GH_PR_BOT_PRIVATE_KEY }}

      - name: Create Pull Request
        uses: actions/github-script@v7
        with:
          github-token: ${{ steps.app-token.outputs.token }}
          script: |
            const { data: pr } = await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '${{ inputs.title }}',
              head: '${{ inputs.branch }}',
              base: 'main',
              body: '${{ inputs.body }}',
              draft: false
            });

            console.log(`Created PR #${pr.number} by ${pr.user.login}: ${pr.html_url}`);
            core.setOutput('pr_number', pr.number);
            core.setOutput('pr_url', pr.html_url);
